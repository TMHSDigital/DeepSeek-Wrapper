<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DeepSeek Chat</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
    function scrollChat() {
        var chat = document.getElementById('chat-history');
        if (chat) chat.scrollTop = chat.scrollHeight;
    }
    function focusInput() {
        var input = document.getElementById('user_message');
        if (input) input.focus();
    }
    window.onload = function() {
        scrollChat();
        focusInput();
    };
    function handleKey(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendChat();
        }
    }
    function sendChat() {
        var btn = document.getElementById('send-btn');
        var form = document.getElementById('chat-form');
        var input = document.getElementById('user_message');
        if (btn) btn.disabled = true;
        form.submit();
        setTimeout(function() { if (input) input.value = ''; }, 100);
    }
    </script>
</head>
<body>
    <div class="container">
        <h1>DeepSeek Chat</h1>
        <form id="chat-form" method="post" action="/chat" autocomplete="off" onsubmit="sendChat(); return false;">
            <textarea id="user_message" name="user_message" placeholder="Type your message... (Enter to send, Shift+Enter for newline)" required rows="2" onkeydown="handleKey(event)"></textarea>
            <button id="send-btn" type="submit" {% if loading %}disabled{% endif %}>Send</button>
            <button type="button" onclick="document.getElementById('reset-form').submit();" class="reset-btn">Reset</button>
        </form>
        <form id="reset-form" method="post" action="/reset" style="display:none;"></form>
        <div id="chat-history" class="chat-history">
            {% for msg in messages %}
                <div class="msg-row {{ msg.role }}">
                    <div class="avatar">{% if msg.role == 'user' %}ðŸ§‘{% else %}ðŸ¤–{% endif %}</div>
                    <div class="bubble {{ msg.role }}-msg">
                        <span class="role">{{ msg.role.title() }}</span>
                        <span class="timestamp">{{ msg.timestamp }}</span><br>
                        {% if msg.role == 'assistant' %}
                            <span class="content" style="display:block;" >{{ msg.content_html|safe }}</span>
                        {% else %}
                            <span class="content">{{ msg.content_html }}</span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
            {% if loading %}
                <div class="msg-row assistant">
                    <div class="avatar">ðŸ¤–</div>
                    <div class="bubble assistant-msg loading-bubble">Assistant is typing...</div>
                </div>
            {% endif %}
        </div>
        {% if error %}
        <div class="error-banner">{{ error }}</div>
        {% endif %}
    </div>
</body>
</html> 